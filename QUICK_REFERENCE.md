# æµ‹è¯•å¤±è´¥é—®é¢˜é€ŸæŸ¥è¡¨

## å¿«é€Ÿæ¦‚è§ˆ

```
é—®é¢˜ç¼–å·  | æµ‹è¯•ç”¨ä¾‹             | ç±»å‹           | ä¸¥é‡åº¦ | éš¾åº¦   | ç›¸å…³å¤±è´¥æ•°
---------|--------------------|----------------|--------|--------|----------
   #1    | 04_arr_defn3        | æ•°ç»„åˆå§‹åŒ–      | ğŸ”´é«˜  | ä¸­ç­‰   | 2
   #2    | 50_short_circuit    | çŸ­è·¯æ±‚å€¼       | ğŸ”´é«˜  | å›°éš¾   | 2
   #3    | 48_assign_complex   | è¡¨è¾¾å¼å¤„ç†      | ğŸŸ¡ä¸­  | å®¹æ˜“   | 1-2
   #4    | 54_hidden_var       | ä½œç”¨åŸŸ+åˆå§‹åŒ–   | ğŸŸ¡ä¸­  | ä¸­ç­‰   | 1
---------|--------------------|----------------|--------|--------|----------
          æ€»è®¡ï¼š4ä¸ªæ ¹æœ¬é—®é¢˜ï¼Œå¯ä¿®å¤6-7ä¸ªå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹
```

## é—®é¢˜é€ŸæŸ¥

### é—®é¢˜ #1: æ•°ç»„åˆå§‹åŒ– âŒ
**ç—‡çŠ¶**ï¼šæ•°ç»„è¢«åˆ†é…ç©ºé—´åï¼Œåˆå§‹å€¼éƒ½æ˜¯æœªå®šä¹‰/é›¶å€¼
```c
int a[4][2] = {1, 2, 3, 4, 5, 6, 7, 8};  // âŒ æœªåˆå§‹åŒ–ï¼
```
**æ ¹å› **ï¼š`visitVarDef()` ç¼ºå°‘è°ƒç”¨ `initializeArray()`
**ä¿®å¤ä»£ç ä½ç½®**ï¼š`include/CodeGenVisitor.h` line 150-210
**ä¿®å¤æ—¶é—´**ï¼š1-2å¤©

### é—®é¢˜ #2: çŸ­è·¯æ±‚å€¼ âŒ
**ç—‡çŠ¶**ï¼š`&&` å’Œ `||` ä¸çŸ­è·¯ï¼Œå³è¾¹è¡¨è¾¾å¼æ€»æ˜¯è¢«è®¡ç®—
```c
if (x > 10 && expensive_func())  // âŒ x <= 10 æ—¶ä»è°ƒç”¨ expensive_func()!
```
**æ ¹å› **ï¼šç”Ÿæˆ `and i1` / `or i1` è€Œä¸æ˜¯æ¡ä»¶è·³è½¬
**ä¿®å¤ä»£ç ä½ç½®**ï¼š`include/CodeGenVisitor.h` line 1174-1270
**ä¿®å¤æ—¶é—´**ï¼š3-5å¤©

### é—®é¢˜ #3: è¡¨è¾¾å¼è®¡ç®— âŒ
**ç—‡çŠ¶**ï¼šå¤æ‚è¡¨è¾¾å¼ä¸­æŸäº›å­è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœè¢«å¿½ç•¥
```c
result = a - -(b) % 2;  // âŒ -(b) % 2 è¢«è®¡ç®—ä½†æœªè¢«ä½¿ç”¨
```
**æ ¹å› **ï¼šè¡¨è¾¾å¼æ ‘éå†æ—¶ä¸­é—´å€¼ä¸¢å¤±
**ä¿®å¤ä»£ç ä½ç½®**ï¼š`include/CodeGenVisitor.h` line 1100-1160
**ä¿®å¤æ—¶é—´**ï¼š1 day

### é—®é¢˜ #4: å…¨å±€æ•°ç»„åˆå§‹åŒ– âŒ
**ç—‡çŠ¶**ï¼šå…¨å±€æ•°ç»„æ²¡æœ‰åˆå§‹å€¼
```c
int c[4] = {6, 7, 8, 9};  // âŒ ç”Ÿæˆ zeroinitializer è€Œä¸æ˜¯ [i32 6, i32 7, ...]
```
**æ ¹å› **ï¼š`visitConstDecl()` ä¸­å…¨å±€æ•°ç»„åˆå§‹åŒ–é€»è¾‘ç¼ºå¤±
**ä¿®å¤ä»£ç ä½ç½®**ï¼š`include/CodeGenVisitor.h` line 280-350
**ä¿®å¤æ—¶é—´**ï¼š0.5å¤©ï¼ˆä¸ #1 ä¸€èµ·ï¼‰

## ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

| ä¼˜å…ˆçº§ | é—®é¢˜ | åŸå›  | æ—¶é—´ |
|--------|------|------|------|
| ğŸ¥‡ ç¬¬1 | #3 (è¡¨è¾¾å¼) | æœ€ç®€å•ï¼Œå¿«é€Ÿèƒœåˆ© | 1å¤© |
| ğŸ¥ˆ ç¬¬2 | #1 + #4 (æ•°ç»„åˆå§‹åŒ–) | ç›¸å…³é—®é¢˜ï¼Œå½±å“é¢å¹¿ | 1-2å¤© |
| ğŸ¥‰ ç¬¬3 | #2 (çŸ­è·¯æ±‚å€¼) | æœ€å¤æ‚ï¼Œéœ€è¦é‡æ„ | 3-5å¤© |

**æ€»ä¿®å¤æ—¶é—´ä¼°è®¡**ï¼š5-8å¤©

## æ£€éªŒæ­¥éª¤

æ¯ä¸ªé—®é¢˜ä¿®å¤åï¼š
```bash
# ç¼–è¯‘
cmake --build build/

# è¿è¡Œç‰¹å®šæµ‹è¯•
python3 run-test.py 2>&1 | grep "04_arr_defn3\|50_short_circuit\|48_assign_complex\|54_hidden_var"

# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python3 run-test.py
```

## å…³é”®ä»£ç æ–‡ä»¶

- **ä¸»è¦ç¼–è¯‘å™¨ä»£ç **ï¼š`include/CodeGenVisitor.h` (1353 è¡Œ)
- **æ„å»ºç³»ç»Ÿ**ï¼š`CMakeLists.txt`
- **ANTLR è¯­æ³•**ï¼š`SysYParser.g4`, `SysYLexer.g4`
- **IR ç”Ÿæˆ**ï¼š`include/IRBuilder.h`, `include/SymbolTable.h`

---

**ç”Ÿæˆæ—¶é—´**: 2025å¹´12æœˆ10æ—¥
**åˆ†ææ·±åº¦**: è¯¦ç»†ä»£ç çº§åˆ†æï¼ŒåŒ…å«æ ¹å› ã€å½±å“èŒƒå›´ã€ä¿®å¤ä½ç½®
